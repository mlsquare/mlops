<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="mlsquare">

<title>07A: Scaling Laws – AI-839</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../lectures/w07-l02.html" rel="next">
<link href="../lectures/w06-l02.html" rel="prev">
<link href="../crisp-ml-process.jpg" rel="icon" type="image/jpeg">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../lectures/w07-l01.html">Lectures[ML Science]</a></li><li class="breadcrumb-item"><a href="../lectures/w07-l01.html">07A: Scaling Laws</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">AI-839</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/mlsquare/ai-839" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../course.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Course</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Lectures[ML Engg.]</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/w01-l01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">01A: Grounding MLOps</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/w02-l01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">02A: Grounding MLOps</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/w02-l02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">02B: Discover</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/w03-l01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">03A: Models for Modeling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/w03-l02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">03B: DevOps for ML</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/w04-l01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">04A: Develop</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/w04-l02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">04B: Monitor (Data)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/w05-l01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">05A: Monitor (Models)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/w05-l02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">05B: Deployment</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/w06-l01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">06A: Evaluate</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/w06-l02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">06B: Govern</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Lectures[ML Science]</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/w07-l01.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">07A: Scaling Laws</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/w07-l02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">07B: Sample Hardness</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/w08-l01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">08A: Model Fitness</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/w09-l01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">09A: Uncertainty Quantification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/w11-l02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11B: Influence Functions</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">LLMs-Ops</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/w13-l01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13A: LLMs Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/w13-l02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13B: LLMs Ops</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/w13-l03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13C: Fullstack LLMs</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Lectures[ML Science]</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/w15-l01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">15A: Meta Learning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/w16-l01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">16A: Fairness &amp; Bias</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/w16-l02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">16B: Machine Unlearning</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../homeworks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homeworks</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../projects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Projects</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tutorials</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../talks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Talks</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Notebooks</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/Sample-Hardness.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Sample Hardness</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/Sample-Fitness.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Sample Fitness</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/Conformal-Predictions.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Conformal Prediction</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../documentation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ML Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../resources/project-card.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Project Card</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#materials" id="toc-materials" class="nav-link active" data-scroll-target="#materials">Materials:</a>
  <ul class="collapse">
  <li><a href="#pre-work" id="toc-pre-work" class="nav-link" data-scroll-target="#pre-work">Pre-work:</a></li>
  <li><a href="#in-class" id="toc-in-class" class="nav-link" data-scroll-target="#in-class">In-Class</a></li>
  <li><a href="#post-class" id="toc-post-class" class="nav-link" data-scroll-target="#post-class">Post-class</a></li>
  <li><a href="#additional-reading-optional" id="toc-additional-reading-optional" class="nav-link" data-scroll-target="#additional-reading-optional">Additional Reading (optional)</a></li>
  </ul></li>
  <li><a href="#notes" id="toc-notes" class="nav-link" data-scroll-target="#notes">Notes</a>
  <ul class="collapse">
  <li><a href="#what-to-collect" id="toc-what-to-collect" class="nav-link" data-scroll-target="#what-to-collect">What to collect?</a></li>
  <li><a href="#how-many" id="toc-how-many" class="nav-link" data-scroll-target="#how-many">How many?</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/mlsquare/ai-839/edit/main/lectures/w07-l01.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/mlsquare/ai-839/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../lectures/w07-l01.html">Lectures[ML Science]</a></li><li class="breadcrumb-item"><a href="../lectures/w07-l01.html">07A: Scaling Laws</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">07A: Scaling Laws</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="materials" class="level2">
<h2 class="anchored" data-anchor-id="materials">Materials:</h2>
<p>Date: Tuesday, 10-Sep-2024</p>
<section id="pre-work" class="level3">
<h3 class="anchored" data-anchor-id="pre-work">Pre-work:</h3>
<ol type="1">
<li><a href="https://online.stat.psu.edu/stat503/lesson/2">Lesson 2</a> of Stat503 on planning a simple comparative experiment</li>
</ol>
</section>
<section id="in-class" class="level3">
<h3 class="anchored" data-anchor-id="in-class">In-Class</h3>
<ol type="1">
<li>Review sample size calculation in t-test. How sample size is a function of data quality, confidence, and tolerance for errors in the conclusions. Except in simple cases, getting a good sense of the “how much data” is a hard, rather very hard question. But we can try.</li>
<li>Myth Buster - more data is better
<ul>
<li>it is like a tautology. this notion never gets challenged. More data does not lead to better RoI. In fact, more of the same can never improve performance beyond a point or in some specific cases, it is impossible.</li>
<li>law of diminishing returns. collecting more data can not only be expensive but can saturate, reaching a plateau. In fact, collecting data to understand where this plateau and what is the ceiling is, is an interesting problem in itself. A well designed experiment can address this question.</li>
</ul></li>
<li>Can we estimate the sample size needed?
<ul>
<li>back of the envelope calculations based on <em>some</em> idea about the data, based on two-sample sample size calculations</li>
<li>from PAC theory bounds (Chapter 8 of <a href="https://onlinelibrary.wiley.com/doi/book/10.1002/9781118023471">An Elementary Introduction to Statistical Learning Theory</a>)</li>
<li>empirical scaling laws</li>
</ul></li>
</ol>
</section>
<section id="post-class" class="level3">
<h3 class="anchored" data-anchor-id="post-class">Post-class</h3>
<ol type="1">
<li>[book] <a href="https://onlinelibrary.wiley.com/doi/book/10.1002/9781118023471">An Elementary Introduction to Statistical Learning Theory</a>. See Chapter 8 for how the theory of VC Dimension can be applied to get an idea on the sample size.</li>
<li>[youtube] <a href="https://www.youtube.com/watch?v=qOMOYM0WCzU">PAC Learning</a> Ali Ghosi Lec 19 PAC Learning, STAT 441/841 Statistical Learning, University of Waterloo</li>
<li>[paper] <a href="https://arxiv.org/abs/2203.15556">Training Compute-Optimal LLMs</a></li>
</ol>
</section>
<section id="additional-reading-optional" class="level3">
<h3 class="anchored" data-anchor-id="additional-reading-optional">Additional Reading (optional)</h3>
<ol type="1">
<li>[book-online] <a href="https://lbelzile.github.io/lineaRmodels/">Linear Models</a> - first regression course for EPFL mathematicians.</li>
<li>[paper] <a href="https://arxiv.org/html/2402.03460v2">Approximation Rates and VC-Dimension Bounds for (P)ReLU MLP Mixture of Experts</a></li>
<li>[book] <a href="https://www.cs.huji.ac.il/~shais/UnderstandingMachineLearning/">Understanding Machine Learning: From Theory to Algorithms</a> - a classic from Shai Shalev-Shwartz and Shai Ben-David. Part-1. <a href="https://www.youtube.com/playlist?list=PLPW2keNyw-usgvmR7FTQ3ZRjfLs5jT4BO">youtube playlist</a></li>
<li>[paper] <a href="https://arxiv.org/abs/2001.08361">Scaling Laws for Neural Language Models</a></li>
<li>[paper] <a href="https://arxiv.org/abs/2408.16947v1">An empirical study of scaling laws for transfer learning</a></li>
<li>[paper] <a href="https://arxiv.org/abs/2405.20456">Scaling laws for Individual data points</a></li>
<li>[paper] <a href="https://arxiv.org/abs/2406.08466v1">Scaling laws in Linear Regression</a></li>
</ol>
</section>
</section>
<section id="notes" class="level2">
<h2 class="anchored" data-anchor-id="notes">Notes</h2>
<p>When embarking on a problem, the first set of questions we are asked are:</p>
<ol type="1">
<li>What type/kind of data is needed or useful for the problem at hand?</li>
<li>How many samples do you need? A new name for this is <em>scaling laws</em> :)</li>
<li>How hard the problem is - are all examples will be equally important?</li>
</ol>
<p>Let us briefly discuss the first question about “<strong>what kind</strong>”.</p>
<section id="what-to-collect" class="level3">
<h3 class="anchored" data-anchor-id="what-to-collect">What to collect?</h3>
<p>We <a href="../lectures/w02-l02.html">discussed</a> ideation tools like <a href="https://web.stanford.edu/~mshanks/MichaelShanks/files/509554.pdf">Design Thinking</a>, <a href="https://online.hbs.edu/blog/post/what-is-human-centered-design">Human-centered Design</a> to engage with the problem (to define what to solve). In the <a href="../resources/project-card.html">Project Canvas</a>, we also discussed what is the ML Task, and what kind of data is needed to solve the business problem.</p>
<p>For example, suppose the problem is, say, assessing the quality of food grains. The business problem is to objectively assess the grain quality and decide a fair price linked to the quality. ML problem is to grade the grains, identify any foreign materia/contaminations, may be based on the morphology of the grains. What kind of data is needed here? We can treat this problem as a combination of segmentation, object detection, object classification, morphology analysis, and granulometry. Data must support these tasks. See the blogs <a href="https://www.v7labs.com/blog/image-annotation-guide">Image Annotation Definition, Usecases and Types</a>, <a href="https://labelbox.com/guides/image-annotation/">Best practices for successful image annotation</a>, <a href="https://opencv.org/blog/data-annotation/">Data Annotation - A beginner’s guide</a> to delve into annotating images further.</p>
<p>Arguably, annotating images for segmentation at grain level is very time consuming but can potentially be very useful. Treating this problem as a grading problem (accept/ reject) as opposed to provide quality assessment at grain and sample level is relatively easy in terms of annotations. But with <em>accept/reject the lot</em> binary labels at image level one can not pivot to a different ML problem formulation if the solution is proved not useful. This is an inherent design challenge. Getting as many details as possible is desirable but many not be practical. But thankfully, with foundation models like <a href="https://segment-anything.com/">SAM</a>, some of this leg work can be automated. See this <a href="https://arxiv.org/abs/2105.04678">paper</a> on sample selection for efficient image annotation. Most modern annotation studios like <a href="https://www.labellerr.com/">Labellerr</a> offer some support to speed-up the process.</p>
<p>While the above labels support the primary ML task, say the segmentation task, for example, they may not be sufficient to offer SLAs or Model monitoring (battling the unknown unknowns) that we discussed in <a href="../lectures/w05-l01.html">Model Monitoring</a>. Suppose, for the same problem, the model is deployed in two grain collection sites. Training data was collected from the the first site (for rice grains), and model is being is used in the second site. It so happens that the second site is using the model for “wheat” instead of “rice.” Obviously, model will perform poorly. This may not have been anticipated ahead of time. Only way to detect this is to first log the data where the model is being used, and observe the performance <em>by site</em>. That means, <em>where</em> the model is being in this case and any other contextual data is necessary to monitor, diagnose, and improve models over time. This is all but one of the dimensions to think about. Generally speaking, thinking about dimensions is the topic of <em>knowledge representation</em> and <em>knowledge engineering</em>. Dimensional Modeling](https://www.ibm.com/docs/en/ida/9.1.2?topic=modeling-dimensional) is a framework to adopt to collect data that can address the concerns of different stakeholders besides the ML and Data Scientists such as a Software Engineer, QA, Architect, Product Manager, Site Manager etc. IBM’s book on <a href="https://www.redbooks.ibm.com/redbooks/pdfs/sg247138.pdf">Dimensional Modeling: In a Business Intelligence Environment</a> is a definitive guide on this topic. <a href="https://arxiv.org/abs/2305.17196">A knowledge Engineering Primer</a> is perhaps a lighter compared to the book.</p>
<p>Now let us move to the other question. <strong>How many?</strong></p>
</section>
<section id="how-many" class="level3">
<h3 class="anchored" data-anchor-id="how-many">How many?</h3>
<p>This question gets very complicated in no time. And there can be more than one way to develop a heuristic to arrive at an approximate answer. The type of response and approach also depends on the scenario.</p>
<ol type="1">
<li>Exact problem was solved before or data is available which can be used as-is [best case]. Take the data, build a model, and deploy and start using. Such occurrences can be rare but can happen. For example, people counting of a given demographic from traffic camera feeds.</li>
<li>Similar problem solved, except for differences in domain. Take a model trained on that data, collect data on the target domain. Start improving the model over a period of time. Use transfer learning/ supervised fine-tuning methods. If data exists (in literature or on huggingace/kaggle for eg) for that problem, plot <em>accuracy</em> vs <em>sample size</em> and pick a target that gives desired performance. Iterate over it. Do not collect all data at once.</li>
<li>Unlabelled data available in large quantities. In such a case, run a pre-trained model or develop self-supervised learning tasks, get very good representations and try to label those that are easy and/or important for the performance. See <a href="https://github.com/decile-team/cords">cords</a> and other active learning methods. See the application of self-supervised pre-training techniques for multi-lable classification in Chest X-Ray <a href="https://arxiv.org/abs/2211.12931">paper</a></li>
<li>Data exists and similar problem is not solved before [worst case]. Then, one has to design an experiment, provide some inputs (design considerations or operating environment) about the problem, get a ball park sense of the sample size (for the sake of budget, resource and project planning), run a pilot data collection exercise, refine the strategy and iterate. Below, we develop some heuristics to estimate the sample size.</li>
</ol>
<section id="a-statistical-approach" class="level4">
<h4 class="anchored" data-anchor-id="a-statistical-approach">A Statistical Approach</h4>
<p>Let us simplify and consider a <em>regression problem</em>. We are trying to learn a function <span class="math inline">\(f: [0,1] \rightarrow R\)</span>. Imagine you are fitting a decision tree to approximate this function. A decision tree partitions the input space, and in each of the partitions certain statistics like mean and quintiles are computed. For a given instance, the prediction is given by, for example, the mean of all responses of the examples belonging to that partition. So, we can divide or cluster or partition the training data into <span class="math inline">\(K\)</span> subsets and compute some statistic in each these subsets. If unlablled data is available, running a clustering algorithms will give an idea about <span class="math inline">\(K\)</span>. If we assume that the labels (responses) of the k-th partition denoted by <span class="math inline">\(y_k\)</span> follow <span class="math inline">\(N(\mu_k, \sigma^2)\)</span>, we can estimate the <span class="math inline">\((1-\alpha)\)</span> level prediction interval (PI) for <span class="math inline">\(\mu_k\)</span> as <span class="math display">\[\bar{y}_k + z_{1-\frac{\alpha}{2}}\sigma \sqrt{1+\frac{1}{N}}\]</span></p>
<p>where <span class="math inline">\(\bar{y}_k\)</span> is the sample mean, <span class="math inline">\(N\)</span> is the sample size, <span class="math inline">\(\sigma^2\)</span> is the noise variance, <span class="math inline">\(\alpha\)</span> controls the confidence level (or type-1 error of the corresponding hypothesis test). So the “design inputs” needed to solicit a sample size are: <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\sigma^2\)</span>. Sometimes, the precision needed for the estimate can be asserted in terms of the width of the interval (PIW). In this case, PIW is given as <span class="math inline">\(PIW = 2z_{1-\frac{\alpha}{2}}\sigma \sqrt{1+\frac{1}{N}}\)</span>. Now, we can express sample size as a function of <span class="math inline">\(PIW\)</span>, <span class="math inline">\(\alpha\)</span> as: <span class="math inline">\(N = \left(  (\frac{PIW}{2z_{1-\frac{\alpha}{2}}})^{2}-1 \right)^{-1}\)</span>. If there are <span class="math inline">\(K\)</span> partitions, we need to estimate that many <span class="math inline">\(\mu_k\)</span>s. So, the total sample size will be <span class="math inline">\(NK\)</span> assuming all partitions have same variance. If not, is is not hard to update the formula. In someways, the model complexity is captured by <span class="math inline">\(K\)</span>. In general, one does not know these numbers in advance and has to make an educated guess based on domain knowledge and refine the design inputs as the data collection drive is set in motion.</p>
<p>What about the <strong>classification</strong> problem?</p>
<p>Assume it is a binary classification problem. Approach is still identical. Even in the classification setting, estimating the mean and taking <em>argmax</em> to predict the label of the partition is still useful and applicable except that the <span class="math inline">\(PI\)</span> formula needs to be updated. For other types of <em>Tasks</em>, suitable estimate of the target varaible has to be chosen, and derive its PI, and use it to get an estimate of the sample size.</p>
</section>
<section id="an-ml-approach" class="level4">
<h4 class="anchored" data-anchor-id="an-ml-approach">An ML Approach</h4>
<p>Can we <strong>relax the assumptions</strong> and yet come-up with some estimates for <span class="math inline">\(N\)</span>?</p>
<p>We can invoke PAC theory. Suppose <span class="math inline">\(\epsilon\)</span> is the tolerable error (that the test error should not exceed), <span class="math inline">\(\delta\)</span> is the confidence in the learning algorithm that test error can exceed <span class="math inline">\(\epsilon\)</span> by no more than <span class="math inline">\(\delta\)</span> fraction of times and <span class="math inline">\(V\)</span> is the VC-dimensionof the function class. The following bounds from PAC theory can guide us:</p>
<p><span class="math display">\[\frac{1}{\epsilon}\left(4\log(\frac{2}{\delta}) + 8V\log(\frac{13}{\epsilon}) \right) \le N \le \frac{64}{\epsilon^2}\left(2V \log(\frac{V}{\epsilon}) + \log(\frac{4}{\delta}) \right)  \]</span></p>
<p>In particular, if one uses an MLP, following is a lower bound on the VC-dimension <span class="math display">\[V \le 2(d+1)s \log(2.718s)\]</span> where <span class="math inline">\(d\)</span> is the number of features, <span class="math inline">\(s\)</span> is the number of perceptrons in the network. So, in effect, given an MLP architecture (with <span class="math inline">\(s\)</span> number of perceptrons), confidence(<span class="math inline">\(\delta\)</span>), permissible error (<span class="math inline">\(\epsilon\)</span>), input features (<span class="math inline">\(d\)</span>), one can get an idea of the sample size.</p>
<p>Caution: These bounds can be very vacuous and many not be uniformly tight across the range of the inputs. For example, consider the inequality <span class="math inline">\(x^2 \ge x, \forall x \ge 1\)</span>. The gap <span class="math inline">\(|x^2-x|\)</span> grows unboundedly and gets worse as <span class="math inline">\(x\)</span> increases. So, always play with several input values and pick a sensible one. Do not just believe that they will work out of the box. No magics here.</p>
</section>
<section id="a-dl-approach" class="level4">
<h4 class="anchored" data-anchor-id="a-dl-approach">A DL Approach</h4>
<p>For tabular problems, one can use either of the above methods to get a sensible estimate. But for speech, vision, and language datasets, it is both complicated and simple at the same time. Simple in the sense that, one could take pre-trained foundation models and work with their representations and technically use PAC-theory-based heuristics. But the latent dimensions could be extremely large. So, if unlabeled data is available, run a clustering algorithm and figure out the intrinsic dimensionality which can be plugged into previous formulae. It is complicated when one has no prior knowledge and commits to a Deep Learning approach. In such cases, building a simple baselines is still going to be useful. Such a simple model can guide the data collection exercise.</p>
</section>
<section id="what-about-large-language-models" class="level4">
<h4 class="anchored" data-anchor-id="what-about-large-language-models">What about <strong>Large Language Models</strong>?</h4>
<p>Do we want to train custom LLMs or do we want to use them for inference?</p>
<p>For training LLMs, how much data is needed, the compute needed and the performance and emergence of the variables to study play. This area is emerging with results and counter-results. But some early works fit parametric curves to predict performance given training data (counted in terms of number of tokens) and for a given compute budget. The following regression model is considered in <a href="https://arxiv.org/abs/2203.15556">Training Compute-Optimal LLMs</a>, using their notation, known as Chinchila scaling laws : <span class="math display">\[ L(N,D) = \frac{A}{N^{\alpha}} + \frac{B}{D^{\beta}} + E \]</span> where <span class="math inline">\(L()\)</span> is the loss, <span class="math inline">\(D\)</span> is the training dataset size in tokens, <span class="math inline">\(N\)</span> is the model size, <span class="math inline">\(A,B,E,\alpha, \beta\)</span> are unknowns to be fit from experimental data. Under this mode, <span class="math inline">\(E\)</span> is the smallest loss achievable (irreducible noise), with infinite data and infinite compute. Based on large scale experiments, they fit <span class="math display">\[ L(N,D) = \frac{406.4}{N^{0.34}} + \frac{410.7}{D^{0.28}} + 1.69 \]</span>. It may be better to use a more standard notation and rewrite them as: <span class="math display">\[ E(K,N) = \frac{A}{K^{\alpha}} + \frac{B}{N^{\beta}} + \sigma^2 \]</span> where <span class="math inline">\(K\)</span> is the model size/complexity, <span class="math inline">\(N\)</span> is the number of tokens, and <span class="math inline">\(\sigma^2\)</span> is the noise variance. See <a href="https://www.youtube.com/watch?v=CV_eBVwzOaw">Pathways Language Model and Model Scaling</a> from <a href="https://www.achowdhery.com/">Aakanskha</a> for more on Scaling Laws.</p>
<p>Some observations w.r.t LLM scaling laws are:</p>
<ol type="1">
<li>Training LLMs from scratch is an extremely specialized endeavor, requiring not only deep pockets, good understanding of the LLM science but also solid (distributed) systems engineering knowledge.</li>
<li>Both data size and model size of sufficient size are needed to see emergence.</li>
<li>For instruction fine-tuning, about 1k-6k instruction pairs is considered a good start. See <a href="https://arxiv.org/abs/2311.13133">LIMIT: Less Is More for Instruction Tuning Across Evaluation Paradigm</a> . More would be better in this case. Like always, quality and representativeness matter.</li>
<li>For In-Context Learning (ICL), a fewshot learning is better. But instead of prompt engineering in ad-hoc fashion, optimizing prompts in a data driven manner, using frameworks like <a href="https://github.com/stanfordnlp/dspy">DSPy</a>. For example, how many and which examples to include in the fewshot ICL can be optimzed with DSPy. Fewshot is all but one of the strategies to improve the performance of LLMs. See <a href="https://trigaten.github.io/Prompt_Survey_Site/">The Prompt</a> report for more details.</li>
</ol>
</section>
<section id="take-aways" class="level4">
<h4 class="anchored" data-anchor-id="take-aways">Take-aways</h4>
<ol type="1">
<li>Collecting data is an iterative exercise</li>
<li>Play with several design inputs and pick a good starting point. Run several heuristics.</li>
<li>Try to leverage past knowledge (datasets, models, and problem similarity) as much as possible.</li>
<li>Do not collect all data in one tranche but collect often, refine the strategy and iterate.</li>
<li>Incorporate practical constraints. Otherwise, data collection will not even begin.</li>
</ol>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/mlsquare\.github\.io\/ai-839");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../lectures/w06-l02.html" class="pagination-link" aria-label="06B: Govern">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">06B: Govern</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../lectures/w07-l02.html" class="pagination-link" aria-label="07B: Sample Hardness">
        <span class="nav-page-text">07B: Sample Hardness</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>course under prep.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/mlsquare/ai-839/edit/main/lectures/w07-l01.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/mlsquare/ai-839/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This course material was built with <a href="https://quarto.org/">Quarto</a> with <a href="https://github.com/hadley/r4ds">r4ds</a> theme.</p>
</div>
  </div>
</footer>




</body></html>